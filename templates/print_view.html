<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–µ—á–∞—Ç—å HOMELOTO</title>
    <style>
        body { background: #555; text-align: center; font-family: sans-serif; }
        .page { 
            background: white; width: 210mm; min-height: 297mm; 
            margin: 20px auto; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; align-items: center;
        }
        .controls { padding: 20px; color: white; background: #333; margin-bottom: 20px; }
        .ticket-img, .receipt-img { max-width: 100%; margin-bottom: 20px; border: 1px dashed #ccc; }
        .receipt-img { width: 300px; }
        
        .toggle-label { font-size: 18px; margin: 0 15px; cursor: pointer; display: inline-block; }
        input[type="checkbox"] { transform: scale(1.5); margin-right: 5px; }

        .email-form { background: #444; padding: 15px; margin-top: 15px; border-radius: 5px; display: inline-block; }
        .email-input { padding: 8px; width: 200px; border-radius: 4px; border: none; }
        .email-btn { background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        .success-msg { background: #d4edda; color: #155724; padding: 10px; margin: 10px; border-radius: 5px; }
        .error-msg { background: #f8d7da; color: #721c24; padding: 10px; margin: 10px; border-radius: 5px; }

        @media print {
            body { background: white; margin: 0; }
            .controls { display: none; }
            .page { box-shadow: none; margin: 0; width: 100%; }
            .hide-print { display: none !important; }
        }
        .dimmed { opacity: 0.2; }
    </style>
    <script>
        function toggleSection(id, checkbox) {
            var el = document.getElementById(id);
            if (checkbox.checked) { el.classList.remove('hide-print'); el.classList.remove('dimmed'); }
            else { el.classList.add('hide-print'); el.classList.add('dimmed'); }
        }
    </script>
</head>
<body>

    <div class="controls">
        <h2>–ü–æ–∫—É–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="{% if category=='success' %}success-msg{% else %}error-msg{% endif %}">
                  {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        
        <div style="margin: 20px 0;">
            <label class="toggle-label"><input type="checkbox" checked onclick="toggleSection('receiptArea', this)"> üßæ –ü–µ—á–∞—Ç–∞—Ç—å –ß–ï–ö</label>
            <label class="toggle-label"><input type="checkbox" checked onclick="toggleSection('ticketsArea', this)"> üéü –ü–µ—á–∞—Ç–∞—Ç—å –ë–ò–õ–ï–¢–´</label>
        </div>

        <button onclick="window.print()" style="padding: 15px 30px; font-size: 20px; font-weight: bold; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 5px;">üñ® –û–¢–ü–†–ê–í–ò–¢–¨ –ù–ê –ü–ï–ß–ê–¢–¨</button>
        
        <!-- –§–û–†–ú–ê –û–¢–ü–†–ê–í–ö–ò –ù–ê EMAIL -->
        <br>
        <div class="email-form">
            <form action="/send_email" method="post">
                <input type="hidden" name="tr_id" value="{{ tr_id }}">
                <label>üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É:</label>
                <input type="email" name="email" class="email-input" placeholder="client@mail.ru" required>
                <button type="submit" class="email-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>

        <br><br>
        <a href="/cashier" style="color: #ddd;">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Å—Å—É (–ù–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞)</a>
    </div>

    <div class="page">
        <div id="receiptArea">
            <h3>–ß–µ–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h3>
            <img src="{{ receipt_img }}" class="receipt-img">
            <hr style="width: 100%; border-top: 1px dashed black; margin: 20px 0;">
        </div>
        <div id="ticketsArea">
            <h3>–ë–∏–ª–µ—Ç—ã ({{ tickets_imgs|length }} —à—Ç.)</h3>
            {% for img_url in tickets_imgs %}
                <img src="{{ img_url }}" class="ticket-img"><br>
            {% endfor %}
        </div>
    </div>

</body>
</html>
