<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>HOMELOTTO 7/49</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .header { background: #333; color: #fff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .container { display: flex; gap: 20px; }
        
        /* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –í—ã–±–æ—Ä –±–∏–ª–µ—Ç–æ–≤ */
        .tickets-area { flex: 3; }
        .tickets-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –±–∏–ª–µ—Ç–∞ (—á–µ–∫–±–æ–∫—Å —Å–∫—Ä—ã—Ç, —Å—Ç–∏–ª–∏–∑—É–µ–º label) */
        .ticket-card { display: none; } /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∞–º —á–µ–∫–±–æ–∫—Å */
        .ticket-label {
            display: block;
            border: 2px solid #007bff;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: 0.2s;
        }
        .ticket-label:hover { background: #e6f2ff; }
        /* –ï—Å–ª–∏ —á–µ–∫–±–æ–∫—Å –≤—ã–±—Ä–∞–Ω - –º–µ–Ω—è–µ–º —Ü–≤–µ—Ç */
        .ticket-card:checked + .ticket-label {
            background: #007bff;
            color: white;
            border-color: #0056b3;
            transform: scale(1.05);
        }
        .nums { font-size: 12px; color: #555; margin-top: 5px; }
        .ticket-card:checked + .ticket-label .nums { color: #fff; }

        /* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ö–æ—Ä–∑–∏–Ω–∞ –∏ –û–ø–ª–∞—Ç–∞ */
        .sidebar { flex: 1; background: white; padding: 20px; border-radius: 8px; height: fit-content; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
        button.pay-btn { background: green; color: white; font-size: 18px; border: none; cursor: pointer; }
        .total-price { font-size: 24px; font-weight: bold; text-align: center; margin: 10px 0; }
        
        .alert { padding: 10px; background: #d4edda; color: #155724; margin-bottom: 15px; border-radius: 5px; }
    </style>
    
    <script>
        // –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—É–º–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        function updateTotal() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            const price = 100; // –¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞ (—Ö–∞—Ä–¥–∫–æ–¥ –ø–æ–∫–∞)
            const total = checkboxes.length * price;
            document.getElementById('totalDisplay').innerText = total + " —Ä—É–±.";
            document.getElementById('totalInput').value = total;
        }
    </script>
</head>
<body>

    <div class="header">
        <h2>üè™ –ö–∞—Å—Å–∞: {{ email }}</h2>
        <a href="/" style="color: #ccc;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- –í—ã–±–æ—Ä —Ç–∏—Ä–∞–∂–∞ -->
    <form action="/cashier" method="get" style="margin-bottom: 20px;">
        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏—Ä–∞–∂ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏:</label>
        <select name="draw_id" onchange="this.form.submit()">
            <option value="" disabled {% if not current_draw %}selected{% endif %}>-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏—Ä–∞–∂ --</option>
            {% for draw in draws %}
                <option value="{{ draw.id }}" {% if current_draw == draw.id %}selected{% endif %}>
                    –¢–∏—Ä–∞–∂ #{{ draw.id }} (–æ—Ç {{ draw.date }})
                </option>
            {% endfor %}
        </select>
    </form>

    {% if current_draw %}
    <form action="/buy_tickets" method="post">
        <div class="container">
            <!-- –°–µ–∫—Ü–∏—è —Å –±–∏–ª–µ—Ç–∞–º–∏ -->
            <div class="tickets-area">
                <h3>üéü –î–æ—Å—Ç—É–ø–Ω—ã–µ –±–∏–ª–µ—Ç—ã (–¢–∏—Ä–∞–∂ {{ current_draw }})</h3>
                <div class="tickets-grid">
                    {% for t in tickets %}
                        <input type="checkbox" name="ticket_ids" value="{{ t.id }}" id="t_{{ t.id }}" class="ticket-card" onclick="updateTotal()">
                        <label for="t_{{ t.id }}" class="ticket-label">
                            <strong>–ë–∏–ª–µ—Ç #{{ t.ticket_number }}</strong>
                            <div class="nums">{{ t.numbers }}</div>
                        </label>
                    {% else %}
                        <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤ –∏–ª–∏ –≤—Å–µ —Ä–∞—Å–ø—Ä–æ–¥–∞–Ω—ã!</p>
                    {% endfor %}
                </div>
            </div>

            <!-- –°–∞–π–¥–±–∞—Ä –æ–ø–ª–∞—Ç—ã -->
            <div class="sidebar">
                <h3>üí≥ –û–ø–ª–∞—Ç–∞</h3>
                <div class="total-price" id="totalDisplay">0 —Ä—É–±.</div>
                <input type="hidden" name="total_amount" id="totalInput" value="0">
                <input type="hidden" name="draw_id" value="{{ current_draw }}">

                <label>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
                <select name="payment_method">
                    <option value="cash">üíµ –ù–∞–ª–∏—á–Ω—ã–µ</option>
                    <option value="card">üí≥ –ö–∞—Ä—Ç–∞</option>
                </select>

                <label>–ü–æ–ª—É—á–µ–Ω–æ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (–¥–ª—è —Å–¥–∞—á–∏):</label>
                <input type="number" name="cash_received" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 500">

                <button type="submit" class="pay-btn">–û–ü–õ–ê–¢–ò–¢–¨</button>
            </div>
        </div>
    </form>
    {% endif %}

</body>
</html>